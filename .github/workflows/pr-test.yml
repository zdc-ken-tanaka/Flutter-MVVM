name: PR Test Workflow

# PRãƒˆãƒªã‚¬ãƒ¼è¨­å®š
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-test:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # å…¨å±¥æ­´å–å¾—ï¼ˆå·®åˆ†æ¯”è¼ƒç”¨ï¼‰

      # 2. PRæƒ…å ±ã‚’è¡¨ç¤º
      - name: Display PR Information
        run: |
          echo "ğŸ¯ PR Information"
          echo "PR Number: ${{ github.event.pull_request.number }}"
          echo "PR Title: ${{ github.event.pull_request.title }}"
          echo "PR Author: ${{ github.event.pull_request.user.login }}"
          echo "Base Branch: ${{ github.event.pull_request.base.ref }}"
          echo "Head Branch: ${{ github.event.pull_request.head.ref }}"
          echo "Changed Files Count: ${{ github.event.pull_request.changed_files }}"

      # 3. å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€è¦§è¡¨ç¤º
      - name: List Changed Files
        run: |
          echo "ğŸ“ Changed Files:"
          git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }}

      # 4. ç°¡å˜ãªã‚³ãƒ¼ãƒ‰åˆ†æï¼ˆä¾‹ï¼šãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚«ã‚¦ãƒ³ãƒˆï¼‰
      - name: Basic Code Analysis
        run: |
          echo "ğŸ“Š Basic Analysis:"
          echo "Total files: $(find . -type f -name '*.py' -o -name '*.js' -o -name '*.md' | wc -l)"
          echo "Python files: $(find . -name '*.py' | wc -l)"
          echo "JavaScript files: $(find . -name '*.js' | wc -l)"
          echo "Markdown files: $(find . -name '*.md' | wc -l)"

      # 5. PRå¤‰æ›´ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆ
      - name: Create PR Summary
        id: summary
        run: |
          SUMMARY="## ğŸ” PR Analysis Summary
          
          **PR #${{ github.event.pull_request.number }}**: ${{ github.event.pull_request.title }}
          
          ### ğŸ“Š Statistics
          - **Changed Files**: ${{ github.event.pull_request.changed_files }}
          - **Additions**: +${{ github.event.pull_request.additions }}
          - **Deletions**: -${{ github.event.pull_request.deletions }}
          
          ### ğŸ“ Changed Files List
          \`\`\`
          $(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }})
          \`\`\`
          
          ---
          *Auto-generated by GitHub Actions* âš¡"
          
          # è¤‡æ•°è¡Œæ–‡å­—åˆ—ã‚’GitHub Actionsç’°å¢ƒå¤‰æ•°ã«ã‚»ãƒƒãƒˆ
          echo "SUMMARY<<EOF" >> $GITHUB_OUTPUT
          echo "$SUMMARY" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      # 6. PRã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ï¼ˆæ¨©é™ãŒã‚ã‚Œã°ï¼‰
      # - name: Comment on PR
      #   uses: actions/github-script@v7
      #   with:
      #     github-token: ${{ secrets.GITHUB_TOKEN }}
      #     script: |
      #       const summary = `${{ steps.summary.outputs.SUMMARY }}`;
            
      #       github.rest.issues.createComment({
      #         issue_number: context.issue.number,
      #         owner: context.repo.owner,
      #         repo: context.repo.repo,
      #         body: summary
      #       });

      # 7. æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      - name: Test Complete
        run: |
          echo "âœ… PR Test Workflow completed successfully!"
          echo "ğŸ‰ Ready for Claude Code integration!"